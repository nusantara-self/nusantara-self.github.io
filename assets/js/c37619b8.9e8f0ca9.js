"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3186],{4411:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>u,toc:()=>d});var o=t(4848),r=t(8453),s=t(1470),i=t(9365);const a={},l="Remote SSH an IAP-secured server using a terminal or VSCode",u={id:"GCP/Identity-Aware Proxy/remote-ssh-iap",title:"Remote SSH an IAP-secured server using a terminal or VSCode",description:"Getting started",source:"@site/docs/GCP/Identity-Aware Proxy/remote-ssh-iap.md",sourceDirName:"GCP/Identity-Aware Proxy",slug:"/GCP/Identity-Aware Proxy/remote-ssh-iap",permalink:"/docs/GCP/Identity-Aware Proxy/remote-ssh-iap",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1708049744,formattedLastUpdatedAt:"Feb 16, 2024",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Port-forwarding to localhost",permalink:"/docs/GCP/Identity-Aware Proxy/port-forwarding"},next:{title:"Hi!",permalink:"/docs/GCP/Terraform/init"}},c={},d=[{value:"Getting started",id:"getting-started",level:2},{value:"Install the gcloud CLI",id:"install-the-gcloud-cli",level:3},{value:"Authentication with the CLI",id:"gcloud-auth",level:3},{value:"Using a standard terminal",id:"using-a-standard-terminal",level:2},{value:"Using VSCode Remote Explorer",id:"using-vscode-remote-explorer",level:2},{value:"CLI Authentication",id:"cli-authentication",level:3},{value:"SSH tunnel dry run",id:"ssh-tunnel-dry-run",level:3},{value:"Updating your ~/.ssh/config",id:"updating-your-sshconfig",level:3},{value:"Connect to Host on VSCode",id:"connect-to-host-on-vscode",level:3},{value:"Troubleshoot",id:"troubleshoot",level:2},{value:"SSH issues with WSL &amp; VScode on Windows",id:"ssh-issues-with-wsl--vscode-on-windows",level:3}];function h(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"remote-ssh-an-iap-secured-server-using-a-terminal-or-vscode",children:"Remote SSH an IAP-secured server using a terminal or VSCode"}),"\n","\n","\n",(0,o.jsx)(n.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,o.jsx)(n.h3,{id:"install-the-gcloud-cli",children:"Install the gcloud CLI"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://cloud.google.com/sdk/docs/install#linux",children:"Official documentation"})}),"\n",(0,o.jsx)(n.h3,{id:"gcloud-auth",children:"Authentication with the CLI"}),"\n",(0,o.jsxs)(n.p,{children:["Before each session you may launch, make sure to be ",(0,o.jsx)(n.strong,{children:"authenticated with your gcloud account"})," within the CLI"]}),"\n",(0,o.jsxs)(s.A,{groupId:"operating-systems",children:[(0,o.jsx)(i.A,{value:"Linux/mac",label:"Standard",children:(0,o.jsx)("pre",{children:"gcloud auth login"})}),(0,o.jsx)(i.A,{value:"WSL",label:"WSL",children:(0,o.jsx)("pre",{children:"gcloud auth login --no-launch-browser"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"using-a-standard-terminal",children:"Using a standard terminal"}),"\n",(0,o.jsxs)(n.p,{children:["Very straightforward, make sure to be authenticated and run the following command :\n",(0,o.jsx)("pre",{children:"gcloud compute ssh my-instance --tunnel-through-iap "})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"using-vscode-remote-explorer",children:"Using VSCode Remote Explorer"}),"\n",(0,o.jsx)(n.h3,{id:"cli-authentication",children:"CLI Authentication"}),"\n",(0,o.jsxs)(n.p,{children:["As usual, make sure to be authenticated : ",(0,o.jsx)(n.a,{href:"#gcloud-auth",children:"gcloud authentication"})]}),"\n",(0,o.jsx)(n.h3,{id:"ssh-tunnel-dry-run",children:"SSH tunnel dry run"}),"\n",(0,o.jsxs)(n.p,{children:["Then, make sure to ",(0,o.jsx)(n.strong,{children:"dry run ssh tunnel"})," to your instance :"]}),"\n",(0,o.jsx)("pre",{children:"gcloud compute ssh my-instance --tunnel-through-iap --dry-run"}),"\n",(0,o.jsx)(n.p,{children:"You should get a response similar to that one :"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'/usr/bin/ssh -t -i /Users/YOURNAME/.ssh/google_compute_engine \n-o CheckHostIP=no \n-o HashKnownHosts=no -o HostKeyAlias=compute.XXXX -o IdentitiesOnly=yes \n-o StrictHostKeyChecking=yes \n-o UserKnownHostsFile=/Users/YOURNAME/.ssh/google_compute_known_hosts \n-o ProxyCommand="/Library/Frameworks/Python.framework/Versions/3.9/bin/python3 -S /Applications/google-cloud-sdk/lib/gcloud.py compute start-iap-tunnel my-instance %p --listen-on-stdin --project=my-project --zone=my-zone --verbosity=warning" \n-o ProxyUseFdpass=no YOURNAME@compute.XXXX\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Now, what we are going to do is to ",(0,o.jsx)(n.strong,{children:"copy the ProxyCommand"})," out of it, which contains the info we need :\n",(0,o.jsx)(n.code,{children:"/Library/Frameworks/Python [....] -verbosity=warning"})]}),"\n",(0,o.jsx)(n.h3,{id:"updating-your-sshconfig",children:"Updating your ~/.ssh/config"}),"\n",(0,o.jsx)(n.p,{children:"Now, using VScode, let's have a look at our ssh config file :"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"CMD + shift + P"})}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Remote-SSH : Open SSH configuration file"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Into this file, add the following content and make sure to ",(0,o.jsx)(n.strong,{children:"replace the full ProxyCommand"})," by the way copied ealier :"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Host my-instance-name\n  HostName my-instance-name\n  IdentityFile /Users/YOURNAME/.ssh/google_compute_engine\n  CheckHostIP no\n  HashKnownHosts no\n  HostKeyAlias my-instance-name\n  IdentitiesOnly yes\n  StrictHostKeyChecking yes\n  UserKnownHostsFile /Users/YOURNAME/.ssh/google_compute_known_hosts\n  ProxyCommand /Library/Frameworks/Python [....] -verbosity=warning\n  ProxyUseFdpass no\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"Host, HostName & HostKeyAlias"})," can all be replaced by whatever value you wish.\nDo not forget ",(0,o.jsx)(n.em,{children:"setting the right UserKnownHostsFile"})," directory as well as pasting the ",(0,o.jsx)(n.em,{children:"full ProxyCommand content"})]})}),"\n",(0,o.jsx)(n.h3,{id:"connect-to-host-on-vscode",children:"Connect to Host on VSCode"}),"\n",(0,o.jsx)(n.p,{children:"Now, you should be able to remote SSH your IAP-secured instance directly on VScode."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"CMD + shift + P"})}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Remote-SSH : Connect to Host"})}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Pick your new entry ",(0,o.jsx)(n.strong,{children:"'my-instance-name'"}),", which should appear"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You can now use File Explorer tab to go to whatever folder you wish and edit files directly in VSCode. Saving you ton of time if you are not an avid vim programmer."}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["There might be a few additional steps on a ",(0,o.jsx)(n.strong,{children:"Windows"})," environment where you use ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.strong,{children:"Windows Subsystem for Linux"})}),". By default, VSCode does not use the WSL's ssh, which is a problem. See ",(0,o.jsx)(n.a,{href:"#troubleshoot",children:"Troubleshoot"})," below."]})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"troubleshoot",children:"Troubleshoot"}),"\n",(0,o.jsx)(n.h3,{id:"ssh-issues-with-wsl--vscode-on-windows",children:"SSH issues with WSL & VScode on Windows"}),"\n",(0,o.jsx)(n.p,{children:"Coming later"})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>i});t(6540);var o=t(8215);const r={tabItem:"tabItem_Ymn6"};var s=t(4848);function i(e){let{children:n,hidden:t,className:i}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,o.A)(r.tabItem,i),hidden:t,children:n})}},1470:(e,n,t)=>{t.d(n,{A:()=>j});var o=t(6540),r=t(8215),s=t(3104),i=t(6347),a=t(205),l=t(7485),u=t(1682),c=t(9466);function d(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:o,default:r}}=e;return{value:n,label:t,attributes:o,default:r}}))}(t);return function(e){const n=(0,u.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function m(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:t}=e;const r=(0,i.W6)(),s=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(s),(0,o.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(r.location.search);n.set(s,e),r.replace({...r.location,search:n.toString()})}),[s,r])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,s=h(e),[i,l]=(0,o.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const o=t.find((e=>e.default))??t[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:s}))),[u,d]=p({queryString:t,groupId:r}),[g,x]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,s]=(0,c.Dv)(t);return[r,(0,o.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:r}),y=(()=>{const e=u??g;return m({value:e,tabValues:s})?e:null})();(0,a.A)((()=>{y&&l(y)}),[y]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),x(e)}),[d,x,s]),tabValues:s}}var x=t(2303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(4848);function b(e){let{className:n,block:t,selectedValue:o,selectValue:i,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,s.a_)(),c=e=>{const n=e.currentTarget,t=l.indexOf(n),r=a[t].value;r!==o&&(u(n),i(r))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},n),children:a.map((e=>{let{value:n,label:t,attributes:s}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:o===n?0:-1,"aria-selected":o===n,ref:e=>l.push(e),onKeyDown:d,onClick:c,...s,className:(0,r.A)("tabs__item",y.tabItem,s?.className,{"tabs__item--active":o===n}),children:t??n},n)}))})}function v(e){let{lazy:n,children:t,selectedValue:r}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===r));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function w(e){const n=g(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",y.tabList),children:[(0,f.jsx)(b,{...e,...n}),(0,f.jsx)(v,{...e,...n})]})}function j(e){const n=(0,x.A)();return(0,f.jsx)(w,{...e,children:d(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var o=t(6540);const r={},s=o.createContext(r);function i(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);