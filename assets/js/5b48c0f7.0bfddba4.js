"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[71],{3905:(e,n,t)=>{t.d(n,{Zo:()=>i,kt:()=>O});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var E=r.createContext({}),_=function(e){var n=r.useContext(E),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},i=function(e){var n=_(e.components);return r.createElement(E.Provider,{value:n},e.children)},f={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,s=e.originalType,E=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),u=_(t),O=o,S=u["".concat(E,".").concat(O)]||u[O]||f[O]||s;return t?r.createElement(S,a(a({ref:n},i),{},{components:t})):r.createElement(S,a({ref:n},i))}));function O(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=t.length,a=new Array(s);a[0]=u;var l={};for(var E in n)hasOwnProperty.call(n,E)&&(l[E]=n[E]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var _=2;_<s;_++)a[_]=t[_];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},4347:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>E,contentTitle:()=>a,default:()=>f,frontMatter:()=>s,metadata:()=>l,toc:()=>_});var r=t(7462),o=(t(7294),t(3905));const s={},a="Shuffle",l={unversionedId:"Shuffle",id:"Shuffle",title:"Shuffle",description:"Resources",source:"@site/docs/Shuffle.mdx",sourceDirName:".",slug:"/Shuffle",permalink:"/docs/Shuffle",draft:!1,tags:[],version:"current",lastUpdatedAt:1690016108,formattedLastUpdatedAt:"Jul 22, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Resources",permalink:"/docs/Security Operations/secops-resources"},next:{title:"TheHive",permalink:"/docs/TheHive"}},E={},_=[{value:"Resources",id:"resources",level:2},{value:"Scripts",id:"scripts",level:2},{value:"Updating Shuffle",id:"updating-shuffle",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Frontend / Backend / DB / &quot;Manager&quot;",id:"frontend--backend--db--manager",level:3},{value:"Worker / Orborus",id:"worker--orborus",level:3},{value:"Issues",id:"issues",level:2},{value:"App malfunctioning",id:"app-malfunctioning",level:3},{value:"Delete the docker image",id:"delete-the-docker-image",level:4}],i={toc:_};function f(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},i,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"shuffle"},"Shuffle"),(0,o.kt)("h2",{id:"resources"},"Resources"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://shuffler.io/docs/configuration"},"Shuffle documentation"))),(0,o.kt)("h2",{id:"scripts"},"Scripts"),(0,o.kt)("h3",{id:"updating-shuffle"},"Updating Shuffle"),(0,o.kt)("p",null,"Valid for both Manager & Worker servers."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="shuffle-update.sh"',title:'"shuffle-update.sh"'},"cd /opt/Shuffle\ndocker-compose down\ngit pull\ndocker-compose pull\ndocker-compose up -d --remove-orphans\ndocker pull frikky/shuffle:app_sdk\ndocker pull ghcr.io/shuffle/shuffle-worker:latest\n")),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("h3",{id:"frontend--backend--db--manager"},'Frontend / Backend / DB / "Manager"'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Shuffle/docker-compose.yml"',title:'"Shuffle/docker-compose.yml"'},'version: \'3\'\nservices:\n  frontend:\n    #build: ./frontend\n    image: ghcr.io/shuffle/shuffle-frontend:latest\n    container_name: shuffle-frontend\n    hostname: shuffle-frontend\n    ports:\n      - "${FRONTEND_PORT}:80"\n      - "${FRONTEND_PORT_HTTPS}:443"\n    networks:\n      - shuffle\n    environment:\n      - BACKEND_HOSTNAME=${BACKEND_HOSTNAME}\n    restart: unless-stopped\n    depends_on:\n      - backend\n  backend:\n    #build: ./backend\n    image: ghcr.io/shuffle/shuffle-backend:latest\n    container_name: shuffle-backend\n    hostname: ${BACKEND_HOSTNAME}\n    # Here for debugging:\n    ports:\n      - "${BACKEND_PORT}:5001"\n    networks:\n      - shuffle\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n      - ${SHUFFLE_APP_HOTLOAD_LOCATION}:/shuffle-apps\n      - ${SHUFFLE_FILE_LOCATION}:/shuffle-files\n      #- ${SHUFFLE_OPENSEARCH_CERTIFICATE_FILE}:/shuffle-files/es_certificate\n    env_file: .env\n    environment:\n      - SHUFFLE_APP_HOTLOAD_FOLDER=/shuffle-apps\n      - SHUFFLE_FILE_LOCATION=/shuffle-files\n    restart: unless-stopped\n    depends_on:\n      - opensearch #Not necessary because dependancy is handled within the backend itself instead\n      #- database\n  opensearch:\n    image: opensearchproject/opensearch:2\n    hostname: shuffle-opensearch\n    container_name: shuffle-opensearch\n    environment:\n      - bootstrap.memory_lock=true\n      - "OPENSEARCH_JAVA_OPTS=-Xms4096m -Xmx4096m" # minimum and maximum Java heap size, recommend setting both to 50% of system RAM\n      - cluster.routing.allocation.disk.threshold_enabled=false\n      - cluster.name=shuffle-cluster\n      - node.name=shuffle-opensearch\n      - discovery.seed_hosts=shuffle-opensearch\n      - cluster.initial_master_nodes=shuffle-opensearch\n      - node.store.allow_mmap=false\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n      nofile:\n        soft: 65536 \n        hard: 65536\n    volumes:\n      - ${DB_LOCATION}:/usr/share/opensearch/data:rw\n    ports:\n      - 9200:9200\n    networks:\n      - shuffle\n    restart: unless-stopped\nnetworks:\n  shuffle:\n    driver: bridge\n    #driver: overlay \n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Shuffle/.env"',title:'"Shuffle/.env"'},'# Default execution environment for workers\nORG_ID=Shuffle\nENVIRONMENT_NAME=Shuffle\n\n\n# Remote github config for first load\nSHUFFLE_DOWNLOAD_WORKFLOW_LOCATION=\nSHUFFLE_DOWNLOAD_WORKFLOW_USERNAME=\nSHUFFLE_DOWNLOAD_WORKFLOW_PASSWORD=\nSHUFFLE_DOWNLOAD_WORKFLOW_BRANCH=\n\nSHUFFLE_APP_DOWNLOAD_LOCATION=https://github.com/nusantara-self/Shuffle-apps\nSHUFFLE_DOWNLOAD_AUTH_USERNAME=\nSHUFFLE_DOWNLOAD_AUTH_PASSWORD=\nSHUFFLE_DOWNLOAD_AUTH_BRANCH=\nSHUFFLE_APP_FORCE_UPDATE=false\nSSO_REDIRECT_URL=https://your-shuffle-domain-name.com\n\n\n# User config for first load. Username & PW: min length 3\nSHUFFLE_DEFAULT_USERNAME=\nSHUFFLE_DEFAULT_PASSWORD=\nSHUFFLE_DEFAULT_APIKEY=\n\n# Local location of your app directory. Can\'t use ~/\n# Files will get better at some point. Right now: local saving.\nSHUFFLE_APP_HOTLOAD_FOLDER=./shuffle-apps\nSHUFFLE_APP_HOTLOAD_LOCATION=./shuffle-apps\nSHUFFLE_FILE_LOCATION=./shuffle-files\n\n# Encryption modifier. This HAS to be set to encrypt any authentication being used in Shuffle. This is put together with other relevant values to ensure multiple parts are needed to decrypt. \n# If this key is lost or changed, you will have to reauthenticate all apps.\nSHUFFLE_ENCRYPTION_MODIFIER=\n\n# Other configs\nBASE_URL=http://shuffle-backend:5001 \nBACKEND_HOSTNAME=shuffle-backend\nBACKEND_PORT=5001\nFRONTEND_PORT=3001\nFRONTEND_PORT_HTTPS=3443\n\n# CHANGE THIS IF YOU WANT GOOD LOCAL EXECUTIONS:\nOUTER_HOSTNAME=shuffle-backend\nDB_LOCATION=./shuffle-database\nDOCKER_API_VERSION=1.40\n\n# Proxy configurations. SHUFFLE_PASS_WORKER_PROXY must be FALSE to not pass the proxy information to sub-apps.\n# PS: It will skip proxy for \nHTTP_PROXY=\nHTTPS_PROXY=\nSHUFFLE_PASS_WORKER_PROXY=TRUE\nSHUFFLE_PASS_APP_PROXY=FALSE\nTZ=Europe/Amsterdam                     # Timezone-handler in Orborus, Worker and Apps\nORBORUS_CONTAINER_NAME=             # Used to FIND the containername. cgroup v2: issue 501\n\nSHUFFLE_BASE_IMAGE_NAME=shuffle\nSHUFFLE_BASE_IMAGE_REGISTRY=ghcr.io\nSHUFFLE_BASE_IMAGE_TAG_SUFFIX="-1.1.0"\n\n# Used for auto-cleanup of containers. REALLY important at scale.\nSHUFFLE_CONTAINER_AUTO_CLEANUP=true\nSHUFFLE_ELASTIC=true\nSHUFFLE_LOGS_DISABLED=false\nSHUFFLE_CHAT_DISABLED=false\nSHUFFLE_RERUN_SCHEDULE=300\n\n# DATABASE CONFIGURATIONS\nDATASTORE_EMULATOR_HOST=shuffle-database:8000\n#SHUFFLE_OPENSEARCH_URL=http://shuffle-opensearch:9200\nSHUFFLE_OPENSEARCH_URL=https://shuffle-opensearch:9200\nSHUFFLE_OPENSEARCH_USERNAME=admin\nSHUFFLE_OPENSEARCH_PASSWORD=admin\nSHUFFLE_OPENSEARCH_CERTIFICATE_FILE=\nSHUFFLE_OPENSEARCH_APIKEY=\nSHUFFLE_OPENSEARCH_CLOUDID=\nSHUFFLE_OPENSEARCH_PROXY=\nSHUFFLE_OPENSEARCH_INDEX_PREFIX=\nSHUFFLE_OPENSEARCH_SKIPSSL_VERIFY=true\n\n')),(0,o.kt)("h3",{id:"worker--orborus"},"Worker / Orborus"),(0,o.kt)("p",null,"On a separate server"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="Shuffle/docker-compose.yml"',title:'"Shuffle/docker-compose.yml"'},"version: '3'\nservices:\n  orborus:\n    #build: ./functions/onprem/orborus\n    image: ghcr.io/shuffle/shuffle-orborus:latest\n    container_name: shuffle-orborus\n    hostname: shuffle-orborus\n    networks:\n      - shuffle\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - SHUFFLE_WORKER_VERSION=latest\n      - SHUFFLE_APP_SDK_VERSION=latest\n      - ORG_ID=${ENVIRONMENT_NAME}\n      - ENVIRONMENT_NAME=${ENVIRONMENT_NAME}\n      - BASE_URL=http://MANAGER-IP:5001\n      - DOCKER_API_VERSION=1.40\n      - SHUFFLE_BASE_IMAGE_NAME=${SHUFFLE_BASE_IMAGE_NAME}\n      - SHUFFLE_BASE_IMAGE_REGISTRY=${SHUFFLE_BASE_IMAGE_REGISTRY}\n      - SHUFFLE_BASE_IMAGE_TAG_SUFFIX=${SHUFFLE_BASE_IMAGE_TAG_SUFFIX}\n      - HTTP_PROXY=${HTTP_PROXY}\n      - HTTPS_PROXY=${HTTPS_PROXY}\n      - SHUFFLE_PASS_WORKER_PROXY=${SHUFFLE_PASS_WORKER_PROXY}\n      - SHUFFLE_PASS_APP_PROXY=${SHUFFLE_PASS_APP_PROXY}\n      - SHUFFLE_ORBORUS_EXECUTION_TIMEOUT=550\n      - SHUFFLE_ORBORUS_EXECUTION_CONCURRENCY=25\n      - CLEANUP=true\n    restart: unless-stopped\nnetworks:\n  shuffle:\n    driver: bridge\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Example of Shuffle/.env"',title:'"Example',of:!0,'Shuffle/.env"':!0},'# Default execution environment for workers\nORG_ID=Shuffle\nENVIRONMENT_NAME=OrborusPROD\n\n\n# Remote github config for first load\nSHUFFLE_DOWNLOAD_WORKFLOW_LOCATION=\nSHUFFLE_DOWNLOAD_WORKFLOW_USERNAME=\nSHUFFLE_DOWNLOAD_WORKFLOW_PASSWORD=\nSHUFFLE_DOWNLOAD_WORKFLOW_BRANCH=\n\nSHUFFLE_APP_DOWNLOAD_LOCATION=https://github.com/shuffle/python-apps\nSHUFFLE_DOWNLOAD_AUTH_USERNAME=\nSHUFFLE_DOWNLOAD_AUTH_PASSWORD=\nSHUFFLE_DOWNLOAD_AUTH_BRANCH=\nSHUFFLE_APP_FORCE_UPDATE=false\n\n# User config for first load. Username & PW: min length 3\nSHUFFLE_DEFAULT_USERNAME=\nSHUFFLE_DEFAULT_PASSWORD=\nSHUFFLE_DEFAULT_APIKEY=\n\n# Local location of your app directory. Can\'t use ~/\n# Files will get better at some point. Right now: local saving.\nSHUFFLE_APP_HOTLOAD_FOLDER=./shuffle-apps\nSHUFFLE_APP_HOTLOAD_LOCATION=./shuffle-apps\nSHUFFLE_FILE_LOCATION=./shuffle-files\n\n# Encryption modifier. This HAS to be set to encrypt any authentication being used in Shuffle. This is put together with other relevant values to ensure multiple parts are needed to decrypt. \n# If this key is lost or changed, you will have to reauthenticate all apps.\nSHUFFLE_ENCRYPTION_MODIFIER=\n\n# Other configs\nBASE_URL=http://shuffle-backend:5001 \nBACKEND_HOSTNAME=shuffle-backend\nBACKEND_PORT=5001\nFRONTEND_PORT=3001\nFRONTEND_PORT_HTTPS=3443\n\n# CHANGE THIS IF YOU WANT GOOD LOCAL EXECUTIONS:\nOUTER_HOSTNAME=shuffle-backend\nDB_LOCATION=./shuffle-database\nDOCKER_API_VERSION=1.40\n\n# Proxy configurations. SHUFFLE_PASS_WORKER_PROXY must be FALSE to not pass the proxy information to sub-apps.\n# PS: It will skip proxy for \nHTTP_PROXY=\nHTTPS_PROXY=\nSHUFFLE_PASS_WORKER_PROXY=TRUE\nSHUFFLE_PASS_APP_PROXY=FALSE\nTZ=Europe/Amsterdam                     # Timezone-handler in Orborus, Worker and Apps\nORBORUS_CONTAINER_NAME=             # Used to FIND the containername. cgroup v2: issue 501\n\nSHUFFLE_BASE_IMAGE_NAME=shuffle\nSHUFFLE_BASE_IMAGE_REGISTRY=ghcr.io\nSHUFFLE_BASE_IMAGE_TAG_SUFFIX="-1.1.0"\n\n# Used for auto-cleanup of containers. REALLY important at scale.\nSHUFFLE_CONTAINER_AUTO_CLEANUP=true\nSHUFFLE_ELASTIC=true\nSHUFFLE_LOGS_DISABLED=false\n\n# Cleans up any containers related to Shuffle that have been up for more than 600 seconds.\nSHUFFLE_ORBORUS_EXECUTION_TIMEOUT=500\n\n# Decides the max amount of workflows to concurrenly run. Defaults to 10.\n# Example math: 10 workflows * WITH 10 apps / second = 110 containers per second.\n# We recommend starting with 10 and going higher as need be.\nSHUFFLE_ORBORUS_EXECUTION_CONCURRENCY=30\n\n# DATABASE CONFIGURATIONS\nDATASTORE_EMULATOR_HOST=shuffle-database:8000\n#SHUFFLE_OPENSEARCH_URL=http://shuffle-opensearch:9200\nSHUFFLE_OPENSEARCH_URL=https://shuffle-opensearch:9200\nSHUFFLE_OPENSEARCH_USERNAME=admin\nSHUFFLE_OPENSEARCH_PASSWORD=admin\nSHUFFLE_OPENSEARCH_CERTIFICATE_FILE=\nSHUFFLE_OPENSEARCH_APIKEY=\nSHUFFLE_OPENSEARCH_CLOUDID=\nSHUFFLE_OPENSEARCH_PROXY=\nSHUFFLE_OPENSEARCH_INDEX_PREFIX=\nSHUFFLE_OPENSEARCH_SKIPSSL_VERIFY=true\n\n')),(0,o.kt)("h2",{id:"issues"},"Issues"),(0,o.kt)("h3",{id:"app-malfunctioning"},"App malfunctioning"),(0,o.kt)("p",null,"When an application is not working as expected, a few actions may need to be taken. ",(0,o.kt)("em",{parentName:"p"},"(incomplete listing)")),(0,o.kt)("h4",{id:"delete-the-docker-image"},"Delete the docker image"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker image ls\ndocker rmi frikky/shuffle:exampleapp_1.0.1\n")))}f.isMDXComponent=!0}}]);